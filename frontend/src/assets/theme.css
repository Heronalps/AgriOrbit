/* Unified Theme for Agriculture Advisor Map Application */

/* Theme variables */
:root {
    /* PrimeVue standard surface variables (using original color values) */
    --surface-ground: #f8f9fa; /* Original --surface-b value */
    --surface-card: #ffffff;   /* Original --surface-a, --surface-e, --surface-f value */
    --surface-overlay: #ffffff;/* Original --surface-a, --surface-e, --surface-f value (typically same as card) */
    --surface-border: #dee2e6; /* Original --surface-d value */
    --surface-hover: #e9ecef;  /* Original --surface-c value (plausible for hover) */

    /* Aliases for backward compatibility with existing custom styles */
    /* These can be phased out by refactoring usages to the standard PrimeVue variables above */
    --surface-a: var(--surface-card);
    --surface-b: var(--surface-ground);
    --surface-c: var(--surface-hover);
    --surface-d: var(--surface-border);
    --surface-e: var(--surface-card);
    --surface-f: var(--surface-card);
    
    /* Text colors */
    --text-color: #343a40;
    --text-color-secondary: #6c757d;
    
    /* App-specific colors */
    --widget-background: #231f1fc8; /* Semi-transparent dark background for widgets */
    --widget-text-color: #ffffff;   /* White text for dark backgrounds */
    
    /* Brand colors */
    --primary-color: #368535;
    --primary-color-hover: #297029;
    --primary-dark: #225622;
    --primary-light: #5ca25b;
    --primary-lightest: #e3f2e3;
    
    /* Accent colors for agricultural data visualization */
    --crop-health-good: #38a169;
    --crop-health-moderate: #ecc94b;
    --crop-health-poor: #e53e3e;
    
    /* Neutral colors */
    --neutral-100: #f7fafc;
    --neutral-200: #edf2f7;
    --neutral-300: #e2e8f0;
    --neutral-400: #cbd5e0;
    --neutral-500: #a0aec0;
    --neutral-700: #4a5568;
    --neutral-800: #2d3748; /* Adding a darker neutral for dark themes */
    --neutral-900: #1a202c;
    
    /* Typography */
    --font-family: 'Inter', system-ui, -apple-system, sans-serif;
    --font-size-base: 16px;
    --font-family-monospace: 'Courier New', Courier, monospace; /* Example monospace font */
    
    /* Border radius */
    --border-radius: 8px;
    --border-radius-sm: 4px;
    --border-radius-lg: 12px;
    
    /* Shadows */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    
    /* Component-specific styles */
    --widget-header-background: var(--primary-color);
    --widget-header-text-color: white;
    --widget-border: 1px solid #ccc;
    --widget-border-radius: var(--border-radius);
    --widget-box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    
    /* Input field styling */
    --input-background: rgba(255, 255, 255, 0.1);
    --input-border: 1px solid rgba(255, 255, 255, 0.2);
    --input-text-color: white;
    --input-placeholder-color: rgba(255, 255, 255, 0.5);
    
    /* Primary text color */
    --primary-color-text: #ffffff;

    /* RGB versions of colors for opacity usage */
    --primary-color-rgb: 54, 133, 53; /* From --primary-color: #368535; */
    --surface-d-rgb: 222, 226, 230; /* From --surface-d: #dee2e6; */
    --text-color-secondary-rgb: 108, 117, 125; /* From --text-color-secondary: #6c757d; */
    --surface-ground-rgb: 248, 249, 250; /* From --surface-ground: #f8f9fa; */
    --warning-color-rgb: 255, 193, 7; /* Example warning color (yellow/amber) */
    --warning-color: #ffc107; /* Example warning color */
    --link-color: #8ab4f8; /* Example link color */
    --link-hover-color: #aecbfa; /* Example link hover color */
}

/* Base component styling */
.p-component {
    font-family: var(--font-family);
    font-size: var(--font-size-base);
}

/* Button styling */
.p-button.p-component {
    border-radius: var(--border-radius);
    transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
}

/* Primary button styling */
.p-button.p-component.p-button-success,
.p-button.p-component.p-button-primary {
    background: var(--primary-color);
    border-color: var(--primary-color);
}

.p-button.p-component.p-button-success:hover,
.p-button.p-component.p-button-primary:hover {
    background: var(--primary-color-hover);
    border-color: var(--primary-color-hover);
}

/* Form elements styling */
.p-inputtext {
    font-family: var(--font-family);
    border-radius: var(--border-radius);
    padding: 0.75rem;
    transition: box-shadow 0.2s, border-color 0.2s;
}

.p-inputtext:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 1px var(--primary-lightest);
}

/* Dropdown styling */
.p-dropdown {
    border-radius: var(--border-radius);
    width: 100%;
    max-width: 20rem;
}

.p-dropdown-label {
    font-weight: 500;
}

.p-dropdown:not(.p-disabled).p-focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 1px var(--primary-lightest);
}

/* Widget dark theme styling for PDropdown */
.widget-dark-theme .p-dropdown {
    background-color: var(--input-background); /* Use theme variable */
    color: var(--input-text-color); /* Use theme variable */
    border: var(--input-border); /* Use theme variable */
}

.widget-dark-theme .p-dropdown:hover,
.widget-dark-theme .p-dropdown:focus {
    border-color: var(--primary-color); /* Use theme variable */
}

.widget-dark-theme .p-dropdown-panel {
    background-color: var(--neutral-900); /* Use theme variable for dark background */
    border: var(--input-border); /* Use theme variable */
}

.widget-dark-theme .p-dropdown-panel .p-dropdown-items .p-dropdown-item {
    color: var(--input-text-color); /* Use theme variable */
    padding: 0.75rem 1rem;
}

.widget-dark-theme .p-dropdown-panel .p-dropdown-items .p-dropdown-item:hover {
    background-color: rgba(var(--primary-color-rgb), 0.2); /* Use theme variable with opacity */
}

.widget-dark-theme .p-dropdown-panel .p-dropdown-items .p-dropdown-item.p-highlight {
    background-color: rgba(var(--primary-color-rgb), 0.5); /* Use theme variable with opacity */
    color: var(--primary-color-text); /* Use theme variable */
}

/* Light theme styling for PDropdown (default) */
.p-dropdown.p-component {
    background-color: white;
    border-color: var(--neutral-300);
}

.p-dropdown.p-component:hover {
    border-color: var(--primary-light);
}

/* Calendar styling */
.p-calendar {
    width: 100%;
}

.p-calendar .p-inputtext {
    width: 100%;
}

.p-calendar.p-calendar-w-btn .p-datepicker-trigger {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.p-calendar.p-calendar-w-btn .p-datepicker-trigger:hover {
    background-color: var(--primary-color-hover);
    border-color: var(--primary-color-hover);
}

.widget-dark-theme .p-calendar .p-inputtext {
    background-color: var(--input-background);
    color: var(--input-text-color);
    border: var(--input-border);
}

/* Datepicker panel */
.p-datepicker {
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
}

.p-datepicker table td.p-datepicker-today > span {
    border-color: var(--primary-light);
    color: var(--primary-color);
}

.p-datepicker table td > span.p-highlight {
    background: var(--primary-color);
}

.p-datepicker:not(.p-disabled) table td span:not(.p-highlight):not(.p-disabled):hover {
    background: var(--primary-lightest);
}

.widget-dark-theme .p-datepicker {
    background-color: var(--neutral-800); /* Darker shade for datepicker */
    border-color: var(--neutral-700); /* Slightly lighter border */
}

.widget-dark-theme .p-datepicker .p-datepicker-header {
    background-color: var(--neutral-900); /* Even darker for header */
    color: var(--widget-text-color); /* Use theme variable */
}

/* Panel styling for Control panels (ControlPanel, ChatWidget) */
.p-panel .p-panel-header {
    background: var(--widget-header-background);
    color: var(--widget-header-text-color);
    border-top-left-radius: var(--widget-border-radius);
    border-top-right-radius: var(--widget-border-radius);
    padding: 0.75rem 1rem;
    font-weight: 600;
}

.p-panel .p-panel-content {
    background: var(--widget-background);
    color: var(--widget-text-color);
    padding: 1rem;
    border: var(--widget-border);
    border-bottom-right-radius: var(--widget-border-radius);
    border-bottom-left-radius: var(--widget-border-radius);
    border-top: none; /* Remove top border as header has bottom border */
}

.p-panel .p-panel-header-icon {
    color: var(--widget-header-text-color);
    margin-right: 0.5rem;
}

.p-panel .p-panel-header-icon:focus {
    box-shadow: none;
    outline: none;
}

/* Input styling in dark panels */
.widget-dark-theme .p-inputtext,
.widget-dark-theme .p-dropdown, /* This selector is already handled above, but ensure consistency */
.widget-dark-theme .p-calendar input { /* More specific selector for calendar input */
    background-color: var(--input-background);
    color: var(--input-text-color);
    border: var(--input-border);
}

.widget-dark-theme .p-inputtext::placeholder {
    color: var(--input-placeholder-color);
}

.widget-dark-theme .p-inputtext:focus {
    box-shadow: 0 0 0 1px var(--primary-color);
    border-color: var(--primary-color);
}

.p-dropdown-panel .p-dropdown-items .p-dropdown-item.p-highlight {
    background: var(--primary-lightest);
    color: var(--primary-color);
}

/* Calendar styling */
.p-calendar .p-datepicker {
    border-radius: var(--border-radius);
}

.p-datepicker:not(.p-datepicker-inline) {
    box-shadow: var(--shadow-lg);
}

.p-datepicker .p-datepicker-header {
    background: var(--primary-lightest);
}

.p-datepicker table td.p-datepicker-today > span {
    background: var(--neutral-200);
    border-color: var(--neutral-300);
    color: var(--text-color);
}

.p-datepicker table td > span.p-highlight {
    background: var(--primary-color);
}

/* Card styling */
.p-card {
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow);
}

.p-card .p-card-title {
    font-weight: 600;
    color: var(--text-color);
}

/* Panel styling */
.p-panel .p-panel-header {
    background: var(--primary-lightest);
    color: var(--primary-dark);
    border-color: var(--primary-light);
    font-weight: 500;
}

.p-panel .p-panel-content {
    padding: 1rem;
    background: var(--surface-a);
}

/* Toast styling */
.p-toast {
    font-family: var(--font-family);
}

/* OverlayPanel styling */
.p-overlaypanel {
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
}

/* Dialog styling */
.p-dialog {
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
}

.p-dialog .p-dialog-header {
    padding: 1.25rem;
    background: var(--primary-lightest);
}

/* Ensure PrimeVue modals appear above other elements */
.p-dialog-mask {
    z-index: 1100;
}

/* Tooltip styling */
.p-tooltip .p-tooltip-text {
    background: var(--neutral-900);
    color: white;
    border-radius: var(--border-radius);
    padding: 0.5rem 0.75rem;
}

/* Map-specific component styling */
.ag-map-component .p-card {
    background-color: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(5px);
}

/* Widget Dark Theme Specific Styling */
.widget-dark-theme {
    background-color: #231f1fc8;
    color: white;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    overflow: hidden;
}

.widget-dark-theme .chat-header,
.widget-dark-theme :deep(.p-panel-header) {
    background-color: var(--primary-color); /* Use theme variable */
    color: var(--primary-color-text); /* Use theme variable */
    padding: 10px;
    text-align: center;
    position: relative;
    cursor: move;
    user-select: none;
    border-top-left-radius: var(--border-radius); /* Use theme variable */
    border-top-right-radius: var(--border-radius); /* Use theme variable */
    border-bottom: 1px solid var(--primary-dark); /* Add a subtle border */
}

/* Consistent font size across widgets */
.widget-dark-theme h2,
.widget-dark-theme h4 {
    font-size: 1.5em;
    font-weight: 600;
    margin: 0;
    padding: 0;
}

/* Consistent input styling */
.widget-dark-theme .p-inputtext::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

/* Dropdown panel styling */
.widget-dark-theme .p-dropdown-panel .p-dropdown-items .p-dropdown-item {
    color: var(--input-text-color); /* Use theme variable */
}

.widget-dark-theme .p-dropdown-panel .p-dropdown-items .p-dropdown-item:hover {
    background-color: rgba(var(--primary-color-rgb), 0.2); /* Use theme variable with opacity */
}

.widget-dark-theme .p-dropdown-panel .p-dropdown-items .p-dropdown-item.p-highlight {
    background-color: rgba(var(--primary-color-rgb), 0.5); /* Use theme variable with opacity */
    color: var(--primary-color-text); /* Use theme variable */
}

/* Button styling consistency */
.widget-dark-theme .p-button.p-button-secondary {
    background-color: #368535;
    border-color: #368535;
    color: white;
}

.widget-dark-theme .p-button.p-button-secondary:enabled:hover {
    background-color: #297029;
    border-color: #297029;
}

.widget-dark-theme .p-button.p-button-secondary:disabled {
    background-color: rgba(var(--surface-d-rgb), 0.1); /* Use theme variable with opacity */
    border-color: rgba(var(--surface-d-rgb), 0.2); /* Use theme variable with opacity */
    color: rgba(var(--text-color-secondary-rgb), 0.5); /* Use theme variable with opacity */
}

/* Consistent resize handle */
.widget-dark-theme .resize-handle:after {
    border-right: 2px solid rgba(255, 255, 255, 0.5);
    border-bottom: 2px solid rgba(255, 255, 255, 0.5);
}

/* General style for the resize handle element */
.resize-handle {
    position: absolute;
    width: 20px;
    height: 20px;
    bottom: 0;
    right: 0;
    cursor: nwse-resize;
    z-index: 1001; /* Ensure this z-index is managed correctly with other components */
}

/* Visual indicator for bottom-right resize handle */
.resize-handle-br:after {
    content: '';
    position: absolute;
    right: 4px;
    bottom: 4px;
    width: 12px;
    height: 12px;
    border-right: 2px solid var(--neutral-400); 
    border-bottom: 2px solid var(--neutral-400);
}

/* Specific styling for resize handle indicator in widget-dark-theme */
.widget-dark-theme .resize-handle-br:after {
    border-right-color: var(--input-placeholder-color); /* Use theme variable */
    border-bottom-color: var(--input-placeholder-color); /* Use theme variable */
}

/* ChatWidget.vue specific styles */
.chat-widget {
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Prevent content overflow */
    position: fixed;
    z-index: 1000;
    /* Theme properties like background, color, border, border-radius, box-shadow
       are expected to be applied via .widget-dark-theme or other theme classes */
}

.chat-header {
    padding: 10px;
    text-align: center;
    position: relative;
    cursor: move; /* Indicate draggable */
    user-select: none; /* Prevent text selection while dragging */
    /* Background and text color should come from .widget-dark-theme or similar */
}

.chat-header h2 {
    margin: 0;
    font-size: 1.5em;
    font-weight: 700;
    font-family: 'Montserrat', sans-serif; /* Consider moving to --font-family-headings if used elsewhere */
    text-transform: uppercase;
    letter-spacing: 1px;
    /* Color should come from .widget-dark-theme or similar */
}

.farm-setup-container {
    padding: 20px;
    text-align: center;
    /* color: white; -- Should be handled by .widget-dark-theme */
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* .welcome-card styling might be better handled by p-card in widget-dark-theme */
/* Or if specific, prefix with .chat-widget */
.chat-widget .welcome-card { 
    background: rgba(var(--surface-ground-rgb), 0.1); /* Slightly increased opacity for better separation */
    border: none;
    border-radius: var(--border-radius); 
}

/* Ensure text within the welcome card in dark theme is legible */
.widget-dark-theme .welcome-card .p-card-title,
.widget-dark-theme .welcome-card .p-card-content p {
    color: var(--widget-text-color); /* Explicitly set to widget text color (white) */
}

.action-options {
    display: flex;
    flex-direction: column;
    gap: 12px; /* Consider a theme variable for spacing */
    margin: 20px 0;
}

.or-divider {
    margin: 20px 0;
    opacity: 0.8; /* Increased opacity slightly */
    color: var(--widget-text-color); /* Ensure it uses widget text color */
}

.chat-body {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
}

.limited-mode {
    position: relative;
}

.limited-mode::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 30px;
    background: linear-gradient(to bottom, rgba(var(--warning-color-rgb), 0.1), transparent); /* Assuming a --warning-color is defined or use specific RGB */
    pointer-events: none;
}

.token-usage-indicator {
    padding: 8px;
    background: rgba(var(--warning-color-rgb), 0.1); /* Assuming a --warning-color is defined */
    border-top: 1px solid rgba(var(--warning-color-rgb), 0.3); /* Assuming a --warning-color is defined */
}

.token-warning {
    display: flex;
    align-items: center;
    color: var(--warning-color); /* Assuming a --warning-color is defined */
    font-size: 0.85rem;
}

.chat-footer {
    border-top: 1px solid var(--surface-d); /* Use theme variable */
}

.message {
    margin: 5px 0;
}

.message-bubble {
    padding: 10px;
    border-radius: 10px; /* Consider var(--border-radius-sm) or similar */
    max-width: 80%;
    word-wrap: break-word;
    white-space: normal;
    overflow-wrap: break-word;
}

/* Styling for sent messages within .widget-dark-theme */
.widget-dark-theme .sent .message-bubble {
    background: var(--primary-dark); /* Use theme variable */
    color: var(--primary-color-text); /* Use theme variable */
    margin-left: auto;
}

/* Styling for received messages within .widget-dark-theme */
.widget-dark-theme .received .message-bubble {
    background: var(--neutral-700); /* Darker background for received messages */
    color: var(--widget-text-color);
    max-height: none;
    overflow-y: visible;
}

/* Markdown styling within received messages in .widget-dark-theme */
.widget-dark-theme .received .message-bubble p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    white-space: normal;
}

.widget-dark-theme .received .message-bubble ul,
.widget-dark-theme .received .message-bubble ol {
    padding-left: 1.5em;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}

.widget-dark-theme .received .message-bubble li {
    margin-bottom: 0.25em;
}

.widget-dark-theme .received .message-bubble strong,
.widget-dark-theme .received .message-bubble b {
    font-weight: bold;
}

.widget-dark-theme .received .message-bubble em,
.widget-dark-theme .received .message-bubble i {
    font-style: italic;
}

.widget-dark-theme .received .message-bubble code {
    background-color: rgba(var(--surface-d-rgb), 0.1); /* Use theme variable with opacity */
    padding: 0.2em 0.4em;
    border-radius: var(--border-radius-sm); 
    font-family: var(--font-family-monospace); /* Assuming a --font-family-monospace is defined */
}

.widget-dark-theme .received .message-bubble pre {
    background-color: rgba(var(--surface-d-rgb), 0.1); /* Use theme variable with opacity */
    padding: 0.5em;
    border-radius: var(--border-radius-sm); 
    overflow-x: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
}

.widget-dark-theme .received .message-bubble pre code {
    padding: 0;
    background-color: transparent;
    white-space: pre-wrap;
}

.widget-dark-theme .received .message-bubble a {
    color: var(--link-color); /* Assuming a --link-color is defined */
    text-decoration: underline;
}

.widget-dark-theme .received .message-bubble a:hover {
    color: var(--link-hover-color); /* Assuming a --link-hover-color is defined */
}

.suggestions {
    display: flex;
    flex-wrap: wrap;
    padding: 5px;
    gap: 5px; /* Consider a theme variable for spacing */
}

.chat-input {
    display: flex;
    padding: 10px;
    border-top: 1px solid var(--surface-d); /* Use theme variable */
    align-items: center;
    gap: 10px; 
}
